<app-expandable-section title="Evolutions">
  <div class="evolution-chain">
    <div *ngFor="let path of evolutionPaths" class="evolution-row">
      <ng-container *ngFor="let species of path; let i = index">
        <!-- Evolution Cell -->
        <div class="evolution-cell">
          <!-- If species is defined -->
          <ng-container *ngIf="species">
            <app-pokemon-card [pokemon]="species.pokemon_v2_pokemons[0]" [pokemonSpecies]="species">
            </app-pokemon-card>

            <div class="evolution-trigger">
              <ng-container *ngFor="
                let evo of getPokemonEvolution(species.id);
                let i = index;
                let last = last
              ">
                <div *ngFor="let condition of getEvolutionConditions(evo)" class="condition-row">
                  <span class="condition-content">
                    <span *ngIf="condition.text">{{ condition.text }}</span>
                    <ng-container *ngIf="condition.spriteUrl; else spaceSpacer">
                      <img [src]="condition.spriteUrl" [ngClass]="{
                        'condition-icon': true,
                        'gender-icon': condition.text === 'must be',
                        'female-icon': condition.spriteUrl.includes('female'),
                        'male-icon': condition.spriteUrl.includes('male')
                      }" alt="condition sprite" />
                    </ng-container>
                    <ng-template #spaceSpacer>&nbsp;</ng-template>
                    <span *ngIf="condition.suffix">{{ condition.suffix }}</span>
                  </span>
                </div>
                <hr *ngIf="!last" class="evolution-separator" />
              </ng-container>

              <div *ngIf="!isMultiStage(path)" class="no-evolution-message">
                No evolutions
              </div>
            </div>
          </ng-container>
        </div>

        <!-- Arrow between cards -->
        <ng-container *ngIf="i < path.length - 1">
          <svg class="arrow-icon" viewBox="0 0 24 24">
            <path d="m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"></path>
          </svg>
        </ng-container>
      </ng-container>
    </div>
  </div>
</app-expandable-section>
